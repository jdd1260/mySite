angular.module("HoodMapper",["leaflet-directive"]).config(["$logProvider",function(a){a.debugEnabled(!1)}]).controller("MainCtrl",["$scope","$location",function(a,b){function c(){return _.sampleSize(d,30).join("")}a.reset=function(){b.search("data",null),a.data={events:{map:{enable:["click","popupopen","popupclose"],logic:"emit"}},center:{lat:38,lng:-95,zoom:4},markers:{},locations:{}}},b.search().data?(a.data=JSON.parse(b.search().data),_.forEach(a.data.markers,function(b){b.getMessageScope=function(){return a}})):a.reset(),a.$on("leafletDirectiveMap.click",function(b,d){if(a.offClick)return void(a.offClick=!1);var e=d.leafletEvent,f=c();a.data.markers[f]={lat:e.latlng.lat,lng:e.latlng.lng,getMessageScope:function(){return a},message:"<div style='min-height: 15px' ng-init='location=data.locations."+f+"'><p><a target='_blank' ng-if='location.url' ng-href='{{location.url}}'>{{location.name}}</a><span ng-if='!location.url'>{{location.name}}</span></p><p> {{location.description}}</p> </div>",id:f},a.data.locations[f]={},a.edit(f)}),a.data.noEdit=!1,a.$on("leafletDirectiveMarker.popupopen",function(b,c){return a.data.noEdit?void(a.data.noEdit=!1):void a.edit(c.model.id)}),a.$on("leafletDirectiveMarker.popupclose",function(b,c){delete a.editingId,c.model.getMessageScope().offClick=!0}),a.save=function(){delete a.editingId,a.getURL()};var d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");a.getURL=function(){b.search("data",JSON.stringify(a.data)),a.url=b.absUrl()},a.edit=function(b){a.editingId=b},a["delete"]=function(b){delete a.editingId,delete a.data.markers[b],delete a.data.locations[b]},a.getURL(),a.isEmpty=_.isEmpty}]);